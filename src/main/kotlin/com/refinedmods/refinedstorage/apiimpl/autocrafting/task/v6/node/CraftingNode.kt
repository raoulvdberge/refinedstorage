package com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.node

import com.refinedmods.refinedstorage.api.util.Action
import net.minecraft.util.NonNullList
import net.minecraftforge.common.util.Constants
import net.minecraftforge.fluids.FluidInstanceimport

com.refinedmods.refinedstorage.api.util.StackListEntry.stackimport com.refinedmods.refinedstorage.apiimpl.API.Companion.instanceimport com.refinedmods.refinedstorage.api.IRSAPI.getComparerimport com.refinedmods.refinedstorage.api.util.IComparer.isEqualNoQuantityimport com.refinedmods.refinedstorage.api.util.StackListEntry.idimport com.refinedmods.refinedstorage.api.util.IComparer.isEqualimport com.refinedmods.refinedstorage.api.IRSAPI.getQuantityFormatterimport com.refinedmods.refinedstorage.api.util.IQuantityFormatter.formatWithUnitsimport com.refinedmods.refinedstorage.tile.NetworkNodeTile.getNodeimport com.refinedmods.refinedstorage.api.network.INetwork.itemStorageCacheimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCache.getListimport com.refinedmods.refinedstorage.api.util.IStackList.getimport com.refinedmods.refinedstorage.api.network.INetwork.securityManagerimport com.refinedmods.refinedstorage.api.network.security.ISecurityManager.hasPermissionimport com.refinedmods.refinedstorage.api.network.INetwork.itemStorageTrackerimport com.refinedmods.refinedstorage.api.storage.tracker.IStorageTracker.changedimport com.refinedmods.refinedstorage.api.network.INetwork.extractItemimport com.refinedmods.refinedstorage.api.network.INetwork.networkItemManagerimport com.refinedmods.refinedstorage.api.network.item.INetworkItemManager.drainEnergyimport com.refinedmods.refinedstorage.api.network.INetwork.insertItemimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCache.getCraftablesListimport com.refinedmods.refinedstorage.api.network.INetwork.craftingManagerimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingManager.createimport com.refinedmods.refinedstorage.api.autocrafting.task.ICalculationResult.isOkimport com.refinedmods.refinedstorage.api.autocrafting.task.ICalculationResult.getTypeimport com.refinedmods.refinedstorage.api.autocrafting.task.ICalculationResult.getRecursedPatternimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPattern.getStackimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingManager.startimport com.refinedmods.refinedstorage.api.autocrafting.task.ICalculationResult.getTaskimport com.refinedmods.refinedstorage.api.autocrafting.task.ICalculationResult.getPreviewElementsimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingManager.cancelimport com.refinedmods.refinedstorage.api.network.INetwork.fluidStorageCacheimport com.refinedmods.refinedstorage.api.network.INetwork.fluidStorageTrackerimport com.refinedmods.refinedstorage.api.network.INetwork.extractFluidimport com.refinedmods.refinedstorage.util.StackUtils.getFluidimport com.refinedmods.refinedstorage.api.network.INetwork.insertFluidimport com.refinedmods.refinedstorage.api.network.grid.IGrid.isGridActiveimport com.refinedmods.refinedstorage.api.storage.IStorage.extractimport com.refinedmods.refinedstorage.api.storage.IStorage.insertimport com.refinedmods.refinedstorage.api.render.IElementDrawer.drawimport com.refinedmods.refinedstorage.api.network.grid.IGridFactory.getRelevantTileimport com.refinedmods.refinedstorage.api.network.grid.IGridFactory.createFromStackimport com.refinedmods.refinedstorage.api.network.grid.IGridFactory.createFromBlockimport com.refinedmods.refinedstorage.api.network.grid.IGridFactory.typeimport com.refinedmods.refinedstorage.api.network.grid.IGrid.craftingMatriximport com.refinedmods.refinedstorage.api.network.grid.INetworkAwareGrid.networkimport com.refinedmods.refinedstorage.api.util.IStackList.removeimport com.refinedmods.refinedstorage.api.util.StackListResult.stackimport com.refinedmods.refinedstorage.api.util.IStackList.addimport com.refinedmods.refinedstorage.api.network.grid.IGrid.onCraftingMatrixChangedimport com.refinedmods.refinedstorage.api.network.grid.IGrid.craftingResultimport com.refinedmods.refinedstorage.api.IRSAPI.createItemStackListimport com.refinedmods.refinedstorage.api.network.grid.IGrid.onCraftedimport com.refinedmods.refinedstorage.api.network.grid.IGrid.gridTypeimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNode.markDirtyimport com.refinedmods.refinedstorage.api.network.INetwork.nodeGraphimport com.refinedmods.refinedstorage.api.network.INetworkNodeGraph.allimport com.refinedmods.refinedstorage.api.network.INetwork.canRunimport com.refinedmods.refinedstorage.api.network.node.INetworkNode.isActiveimport com.refinedmods.refinedstorage.api.network.IWirelessTransmitter.getDimensionimport com.refinedmods.refinedstorage.api.network.IWirelessTransmitter.originimport com.refinedmods.refinedstorage.api.network.IWirelessTransmitter.rangeimport com.refinedmods.refinedstorage.api.network.item.INetworkItemProvider.provideimport com.refinedmods.refinedstorage.api.network.item.INetworkItem.onOpenimport com.refinedmods.refinedstorage.api.network.item.INetworkItem.drainEnergyimport com.refinedmods.refinedstorage.api.IRSAPI.getGridManagerimport com.refinedmods.refinedstorage.api.network.grid.IGridManager.openGridimport com.refinedmods.refinedstorage.api.network.item.INetworkItemManager.closeimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNode.onConnectedStateChangeimport com.refinedmods.refinedstorage.api.network.INetworkNodeGraph.runActionWhenPossibleimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNode.writeimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNode.readimport com.refinedmods.refinedstorage.api.IRSAPI.getStorageDiskManagerimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskManager.getimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskManager.setimport com.refinedmods.refinedstorage.api.IRSAPI.createDefaultItemDiskimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskManager.markForSavingimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNode.writeConfigurationimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNode.readConfigurationimport com.refinedmods.refinedstorage.util.StackUtils.readItemsimport com.refinedmods.refinedstorage.tile.data .TileDataParameter.valueimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCache.invalidateimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCache.sortimport com.refinedmods.refinedstorage.api.IRSAPI.createDefaultFluidDiskimport com.refinedmods.refinedstorage.api.storage.IStorage.getAccessTypeimport com.refinedmods.refinedstorage.api.storage.IStorage.getStacksimport com.refinedmods.refinedstorage.api.storage.IStorage.getStoredimport com.refinedmods.refinedstorage.api.storage.IStorage.getCacheDeltaimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDisk.capacityimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDisk.setSettingsimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDisk.writeToNbtimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDisk.factoryIdimport com.refinedmods.refinedstorage.util.StackUtils.copyimport com.refinedmods.refinedstorage.util.StackUtils.createStoragesimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNode.updateimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNode.canUpdateimport com.refinedmods.refinedstorage.api.network.node.INetworkNode.worldimport com.refinedmods.refinedstorage.api.network.node.INetworkNode.posimport com.refinedmods.refinedstorage.api.storage.IStorage.getPriorityimport com.refinedmods.refinedstorage.api.network.INetwork.itemGridHandlerimport com.refinedmods.refinedstorage.api.network.INetwork.fluidGridHandlerimport com.refinedmods.refinedstorage.api.IRSAPI.getCraftingGridBehaviorimport com.refinedmods.refinedstorage.api.network.grid.ICraftingGridBehavior.onRecipeTransferimport com.refinedmods.refinedstorage.api.network.grid.ICraftingGridBehavior.onCraftedimport com.refinedmods.refinedstorage.api.network.grid.ICraftingGridBehavior.onCraftedShiftimport com.refinedmods.refinedstorage.api.network.INetworkNodeVisitor.Operator.applyimport com.refinedmods.refinedstorage.api.IRSAPI.isNetworkNodeEqualimport com.refinedmods.refinedstorage.api.IRSAPI.getNetworkNodeHashCodeimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingManager.invalidateimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternProvider.createimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPattern.isValidimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNode.onDisconnectedimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingManager.getTasksimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTask.getPatternimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPattern.getContainerimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainer.getPositionimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTask.getIdimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainer.getFacingTileimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainer.getDirectionimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNode.directionimport com.refinedmods.refinedstorage.api.IRSAPI.getNetworkNodeManagerimport com.refinedmods.refinedstorage.api.network.node.INetworkNodeManager.getNodeimport com.refinedmods.refinedstorage.api.network.node.INetworkNode.networkimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainer.getRootContainerimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainer.isLockedimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainer.onUsedForProcessingimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNode.facingTileimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingManager.requestimport com.refinedmods.refinedstorage.api.network.INetwork.insertItemTrackedimport com.refinedmods.refinedstorage.api.network.INetwork.insertFluidTrackedimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNode.ownerimport com.refinedmods.refinedstorage.api.network.grid.handler.IItemGridHandler.onCraftingCancelRequestedimport com.refinedmods.refinedstorage.api.storage.externalstorage.IExternalStorage.updateimport com.refinedmods.refinedstorage.api.IRSAPI.getExternalStorageProvidersimport com.refinedmods.refinedstorage.api.storage.externalstorage.IExternalStorageProvider.canProvideimport com.refinedmods.refinedstorage.api.storage.externalstorage.IExternalStorageProvider.provideimport com.refinedmods.refinedstorage.api.network.security.ISecurityManager.invalidateimport com.refinedmods.refinedstorage.api.network.INetworkNodeGraph.invalidateimport com.refinedmods.refinedstorage.api.network.INetwork.worldimport com.refinedmods.refinedstorage.api.network.INetwork.positionimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNode.visitimport com.refinedmods.refinedstorage.api.network.security.ISecurityCard.hasPermissionimport com.refinedmods.refinedstorage.api.network.security.ISecurityCardContainer.cardsimport com.refinedmods.refinedstorage.api.network.security.ISecurityCard.ownerimport com.refinedmods.refinedstorage.api.network.security.ISecurityCardContainer.globalCardimport com.refinedmods.refinedstorage.api.network.INetworkNodeGraph.addListenerimport com.refinedmods.refinedstorage.tile.config.RedstoneMode.isEnabledimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingManager.updateimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTask.onCancelledimport com.refinedmods.refinedstorage.api.network.INetworkNodeGraph.disconnectAllimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCache.getStoragesimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCache.addimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCache.removeimport com.refinedmods.refinedstorage.tile.config.RedstoneMode.Companion.readimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingManager.readFromNbtimport com.refinedmods.refinedstorage.tile.config.RedstoneMode.writeimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingManager.writeToNbtimport com.refinedmods.refinedstorage.api.IRSAPI.getNetworkManagerimport com.refinedmods.refinedstorage.api.network.INetworkManager.markForSavingimport com.refinedmods.refinedstorage.api.network.node.INetworkNode.energyUsageimport com.refinedmods.refinedstorage.api.network.INetwork.readFromNbtimport com.refinedmods.refinedstorage.api.network.INetwork.writeToNbtimport com.refinedmods.refinedstorage.api.network.INetwork.typeimport com.refinedmods.refinedstorage.api.network.INetworkManager.allimport com.refinedmods.refinedstorage.api.network.INetwork.updateimport com.refinedmods.refinedstorage.api.network.node.INetworkNodeManager.allimport com.refinedmods.refinedstorage.api.network.node.INetworkNode.updateimport com.refinedmods.refinedstorage.api.network.INetworkNodeVisitor.visitimport com.refinedmods.refinedstorage.api.network.node.INetworkNode.onConnectedimport com.refinedmods.refinedstorage.api.network.node.INetworkNode.onDisconnectedimport com.refinedmods.refinedstorage.api.IRSAPI.getNetworkNodeRegistryimport com.refinedmods.refinedstorage.api.network.node.INetworkNodeRegistry.getimport com.refinedmods.refinedstorage.api.network.node.INetworkNodeFactory.createimport com.refinedmods.refinedstorage.api.network.node.INetworkNode.idimport com.refinedmods.refinedstorage.api.network.node.INetworkNode.writeimport com.refinedmods.refinedstorage.api.network.node.INetworkNode.ownerimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskProvider.isValidimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskProvider.getIdimport com.refinedmods.refinedstorage.api.IRSAPI.getStorageDiskRegistryimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskRegistry.getimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskFactory.createFromNbtimport com.refinedmods.refinedstorage.api.storage.IStorageProvider.addItemStoragesimport com.refinedmods.refinedstorage.api.util.IStackList.clearimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCacheListener.onChangedimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCacheListener.onChangedBulkimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCacheListener.onAttachedimport com.refinedmods.refinedstorage.api.IRSAPI.createFluidInstanceListimport com.refinedmods.refinedstorage.api.storage.IStorageProvider.addFluidStoragesimport com.refinedmods.refinedstorage.util.StackUtils.deserializeStackFromNbtimport com.refinedmods.refinedstorage.api.storage.tracker.StorageTrackerEntry.getTimeimport com.refinedmods.refinedstorage.api.storage.tracker.StorageTrackerEntry.getNameimport com.refinedmods.refinedstorage.util.StackUtils.serializeStackToNbtimport com.refinedmods.refinedstorage.api.IRSAPI.getItemStackHashCodeimport com.refinedmods.refinedstorage.api.storage.externalstorage.IExternalStorageContext.acceptsItemimport com.refinedmods.refinedstorage.api.storage.externalstorage.IExternalStorageContext.getPriorityimport com.refinedmods.refinedstorage.api.storage.externalstorage.IExternalStorageContext.getAccessTypeimport com.refinedmods.refinedstorage.api.storage.externalstorage.IExternalStorageContext.acceptsFluidimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCache.flushimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingManager.getAllContainersimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPattern.isProcessingimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainer.getUpdateIntervalimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainer.getMaximumSuccessfulCraftingUpdatesimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPattern.getOutputimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPattern.getByproductsimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPattern.getOutputsimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPattern.getFluidOutputsimport com.refinedmods.refinedstorage.api.util.IStackList.isEmptyimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainer.getConnectedInventoryimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainer.getConnectedFluidInventoryimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingManager.onTaskChangedimport com.refinedmods.refinedstorage.api.util.IStackList.getCountimport com.refinedmods.refinedstorage.api.IRSAPI.createCraftingMonitorElementListimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElementList.addStorageimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElementList.commitimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElementList.getElementsimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElementList.addimport com.refinedmods.refinedstorage.api.util.IStackList.copyimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingRequestInfo.itemimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingRequestInfo.fluidimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingManager.getPatternimport com.refinedmods.refinedstorage.api.IRSAPI.createCraftingRequestInfoimport com.refinedmods.refinedstorage.apiimpl.storage.disk.factory.ItemStorageDiskFactory.createFromNbtimport com.refinedmods.refinedstorage.apiimpl.storage.disk.factory.FluidStorageDiskFactory.createFromNbtimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingRequestInfo.writeToNbtimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPattern.getInputsimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPattern.getFluidInputsimport com.refinedmods.refinedstorage.api.render.IElementDrawers.overlayDrawerimport com.refinedmods.refinedstorage.api.render.IElementDrawers.itemDrawerimport com.refinedmods.refinedstorage.api.render.IElementDrawers.stringDrawerimport com.refinedmods.refinedstorage.api.render.IElementDrawers.fluidDrawerimport com.refinedmods.refinedstorage.api.util.IQuantityFormatter.formatInBucketFormimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElement.getBaseIdimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElement.baseElementHashCodeimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElement.mergeimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElement.getIdimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElement.elementHashCodeimport com.refinedmods.refinedstorage.util.StackUtils.writeItemStackimport com.refinedmods.refinedstorage.util.StackUtils.readItemStackimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElement.drawimport com.refinedmods.refinedstorage.api.render.IElementDrawers.errorDrawerimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElement.getTooltipimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElement.writeimport com.refinedmods.refinedstorage.api.IRSAPI.getCraftingMonitorElementRegistryimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElementRegistry.getimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTask.startimport com.refinedmods.refinedstorage.api.network.INetwork.markDirtyimport com.refinedmods.refinedstorage.api.IRSAPI.getCraftingTaskRegistryimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTaskRegistry.getimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPattern.getCraftingTaskFactoryIdimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTaskFactory.createimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTaskFactory.createFromNbtimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTask.updateimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTask.writeToNbtimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorListener.onAttachedimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTask.getRequestedimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTask.getQuantityimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTask.onTrackedInsertimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainer.getPatternsimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainer.getPatternInventoryimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainer.getNameimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCache.reAttachListenersimport com.refinedmods.refinedstorage.api.util.IComparerimport net.minecraft.item.ItemStackimport com.refinedmods.refinedstorage.api.util.IFilterimport com.refinedmods.refinedstorage.api.util.IStackListimport com.refinedmods.refinedstorage.api.util.StackListEntryimport java.util.UUIDimport java.util.HashMapimport com.refinedmods.refinedstorage.api.util.StackListResultimport com.refinedmods.refinedstorage.apiimpl.APIimport com.refinedmods.refinedstorage.apiimpl.util.ItemStackListimport com.refinedmods.refinedstorage.api.util.IQuantityFormatterimport java.util.Localeimport java.math.RoundingModeimport com.refinedmods.refinedstorage.screen.BaseScreenimport com.refinedmods.refinedstorage.api.render.IElementDrawersimport com.refinedmods.refinedstorage.api.render.IElementDrawerimport com.refinedmods.refinedstorage.container.CraftingMonitorContainerimport com.refinedmods.refinedstorage.apiimpl.render.ElementDrawersimport com.mojang.blaze3d.systems.RenderSystemimport com.refinedmods.refinedstorage.RSimport com.refinedmods.refinedstorage.screen.grid.CraftingPreviewScreenimport com.refinedmods.refinedstorage.api.network.grid.IGridFactoryimport net.minecraft.entity.player.PlayerEntityimport com.refinedmods.refinedstorage.api.network.grid.IGridimport net.minecraft.util.math.BlockPosimport com.refinedmods.refinedstorage.tile.grid.GridTileimport net.minecraft.world.Worldimport com.refinedmods.refinedstorage.api.network.grid.GridFactoryTypeimport com.refinedmods.refinedstorage.tile.grid.portable.PortableGridTileimport com.refinedmods.refinedstorage.api.network.INetworkimport com.refinedmods.refinedstorage.api.network.grid.handler.IItemGridHandlerimport java.lang.Runnableimport com.refinedmods.refinedstorage.api.autocrafting.task.ICalculationResultimport com.refinedmods.refinedstorage.api.autocrafting.task.CalculationResultTypeimport com.refinedmods.refinedstorage.network.grid.GridCraftingPreviewResponseMessageimport com.refinedmods.refinedstorage.apiimpl.autocrafting.preview.ErrorCraftingPreviewElementimport com.refinedmods.refinedstorage.network.grid.GridCraftingStartResponseMessageimport com.refinedmods.refinedstorage.api.network.grid.handler.IFluidGridHandlerimport com.refinedmods.refinedstorage.util.StackUtilsimport com.refinedmods.refinedstorage.tile.grid.portable.IPortableGridimport com.refinedmods.refinedstorage.api.network.grid.IGridTabimport com.refinedmods.refinedstorage.api.network.grid.IGridManagerimport com.refinedmods.refinedstorage.container.factory.GridContainerProviderimport com.refinedmods.refinedstorage.api.network.grid.ICraftingGridBehaviorimport com.refinedmods.refinedstorage.api.network.grid.INetworkAwareGridimport net.minecraft.inventory.CraftingInventoryimport com.refinedmods.refinedstorage.api.network.grid.GridTypeimport com.refinedmods.refinedstorage.apiimpl.network.node.GridNetworkNodeimport com.refinedmods.refinedstorage.api.network.item.INetworkItemManagerimport com.refinedmods.refinedstorage.api.network.item.INetworkItemimport java.util.concurrent.ConcurrentHashMapimport com.refinedmods.refinedstorage.api.network.node.INetworkNodeimport com.refinedmods.refinedstorage.api.network.IWirelessTransmitterimport com.refinedmods.refinedstorage.api.network.item.INetworkItemProviderimport com.refinedmods.refinedstorage.item.WirelessGridItemimport com.refinedmods.refinedstorage.apiimpl.network.grid.factory.WirelessGridGridFactoryimport com.refinedmods.refinedstorage.item.WirelessFluidGridItemimport com.refinedmods.refinedstorage.apiimpl.network.grid.factory.WirelessFluidGridGridFactoryimport com.refinedmods.refinedstorage.item.WirelessCraftingMonitorItemimport com.refinedmods.refinedstorage.container.factory.CraftingMonitorContainerProviderimport com.refinedmods.refinedstorage.RSContainersimport com.refinedmods.refinedstorage.apiimpl.storage.ItemStorageTypeimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkNodeimport com.refinedmods.refinedstorage.apiimpl.network.node.IStorageScreenimport com.refinedmods.refinedstorage.api.storage.IStorageProviderimport com.refinedmods.refinedstorage.tile.config.IComparableimport com.refinedmods.refinedstorage.tile.config.IWhitelistBlacklistimport com.refinedmods.refinedstorage.tile.config.IPrioritizableimport com.refinedmods.refinedstorage.tile.config.IAccessTypeimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskContainerContextimport com.refinedmods.refinedstorage.inventory.item.BaseItemHandlerimport com.refinedmods.refinedstorage.inventory.listener.NetworkNodeInventoryListenerimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskimport com.refinedmods.refinedstorage.apiimpl.network.node.ConnectivityStateChangeCauseimport com.refinedmods.refinedstorage.apiimpl.network.node.storage.StorageNetworkNodeimport com.refinedmods.refinedstorage.apiimpl.storage.cache.ItemStorageCacheimport com.refinedmods.refinedstorage.api.storage.cache.InvalidateCauseimport com.refinedmods.refinedstorage.api.storage.IStorageimport com.refinedmods.refinedstorage.util.StorageBlockUtilsimport net.minecraft.nbt.CompoundTagimport com.refinedmods.refinedstorage.apiimpl.network.node.storage.ItemStorageWrapperStorageDiskimport com.refinedmods.refinedstorage.util.AccessTypeUtilsimport com.refinedmods.refinedstorage.tile.StorageTileimport com.refinedmods.refinedstorage.apiimpl.storage.FluidStorageTypeimport com.refinedmods.refinedstorage.inventory.fluid.FluidInventoryimport com.refinedmods.refinedstorage.inventory.listener.NetworkNodeFluidInventoryListenerimport com.refinedmods.refinedstorage.apiimpl.network.node.storage.FluidStorageNetworkNodeimport com.refinedmods.refinedstorage.apiimpl.storage.cache.FluidStorageCacheimport com.refinedmods.refinedstorage.util.FluidStorageBlockUtilsimport com.refinedmods.refinedstorage.apiimpl.network.node.storage.FluidStorageWrapperStorageDiskimport com.refinedmods.refinedstorage.tile.FluidStorageTileimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskListenerimport com.refinedmods.refinedstorage.tile.config.ITypeimport com.refinedmods.refinedstorage.inventory.item.validator.StorageDiskItemValidatorimport com.refinedmods.refinedstorage.inventory.listener.InventoryListenerimport com.refinedmods.refinedstorage.apiimpl.network.node.diskdrive.ItemDriveWrapperStorageDiskimport reborncore.common.fluid.container.FluidInstanceimport com.refinedmods.refinedstorage.apiimpl.network.node.diskdrive.FluidDriveWrapperStorageDiskimport com.refinedmods.refinedstorage.apiimpl.network.node.diskdrive.DiskDriveNetworkNodeimport com.refinedmods.refinedstorage.apiimpl.network.node.DiskStateimport com.refinedmods.refinedstorage.tile.DiskDriveTileimport com.refinedmods.refinedstorage.apiimpl.network.node.diskmanipulator.DiskManipulatorNetworkNodeimport com.refinedmods.refinedstorage.inventory.item.UpgradeItemHandlerimport com.refinedmods.refinedstorage.item.UpgradeItemimport com.refinedmods.refinedstorage.apiimpl.network.node.diskmanipulator.StorageDiskItemManipulatorWrapperimport com.refinedmods.refinedstorage.apiimpl.network.node.diskmanipulator.StorageDiskFluidManipulatorWrapperimport com.refinedmods.refinedstorage.inventory.item.ProxyItemHandlerimport java.util.stream.Collectorsimport com.refinedmods.refinedstorage.tile.DiskManipulatorTileimport com.refinedmods.refinedstorage.apiimpl.autocrafting.AllowedTagListimport com.refinedmods.refinedstorage.api.network.grid.ICraftingGridListenerimport java.util.HashSetimport com.refinedmods.refinedstorage.inventory.item.validator.ItemValidatorimport com.refinedmods.refinedstorage.RSItemsimport com.refinedmods.refinedstorage.inventory.item.FilterItemHandlerimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCacheListenerimport com.refinedmods.refinedstorage.apiimpl.storage.cache.listener.FluidGridStorageCacheListenerimport com.refinedmods.refinedstorage.apiimpl.storage.cache.listener.ItemGridStorageCacheListenerimport com.refinedmods.refinedstorage.api.storage.cache.IStorageCacheimport net.minecraft.block.BlockStateimport com.refinedmods.refinedstorage.block.GridBlockimport com.refinedmods.refinedstorage.block.NetworkNodeBlockimport com.refinedmods.refinedstorage.tile.data .TileDataManagerimport com.refinedmods.refinedstorage.util.GridUtilsimport com.refinedmods.refinedstorage.api.network.INetworkNodeVisitorimport com.refinedmods.refinedstorage.apiimpl.network.node.CableNetworkNodeimport com.refinedmods.refinedstorage.apiimpl.network.node.RelayNetworkNodeimport com.refinedmods.refinedstorage.tile.config.RedstoneModeimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternContainerimport com.refinedmods.refinedstorage.apiimpl.network.node.CrafterNetworkNode.CrafterModeimport com.refinedmods.refinedstorage.inventory.item.validator.PatternItemValidatorimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingPatternProviderimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTaskimport com.refinedmods.refinedstorage.apiimpl.network.node.CrafterNetworkNodeimport com.refinedmods.refinedstorage.apiimpl.network.node.DetectorNetworkNodeimport com.refinedmods.refinedstorage.block.DetectorBlockimport com.refinedmods.refinedstorage.RSBlocksimport com.refinedmods.refinedstorage.tile.DetectorTileimport com.refinedmods.refinedstorage.apiimpl.network.node.SlottedCraftingRequestimport com.refinedmods.refinedstorage.apiimpl.network.node.ExporterNetworkNodeimport com.refinedmods.refinedstorage.tile.ExporterTileimport com.refinedmods.refinedstorage.apiimpl.network.node.ImporterNetworkNodeimport com.refinedmods.refinedstorage.tile.ImporterTileimport com.refinedmods.refinedstorage.apiimpl.storage.externalstorage.ItemExternalStorageimport com.refinedmods.refinedstorage.apiimpl.network.node.ExternalStorageNetworkNodeimport com.refinedmods.refinedstorage.apiimpl.network.node.InterfaceNetworkNodeimport com.refinedmods.refinedstorage.apiimpl.network.node.DestructorNetworkNodeimport net.minecraft.fluid.Fluidimport net.minecraft.block.Blocksimport net.minecraft.enchantment.Enchantmentsimport com.refinedmods.refinedstorage.tile.DestructorTileimport com.refinedmods.refinedstorage.apiimpl.network.node.ConstructorNetworkNodeimport net.minecraft.item.BlockItemimport net.minecraft.util.Handimport com.refinedmods.refinedstorage.apiimpl.network.node.ConstructorNetworkNode.NetworkFluidHandlerimport com.refinedmods.refinedstorage.apiimpl.network.node.ConstructorNetworkNode.ConstructorBlockItemUseContextimport net.minecraft.entity.projectile.FireworkRocketEntityimport com.refinedmods.refinedstorage.tile.ConstructorTileimport java.lang.RuntimeExceptionimport com.refinedmods.refinedstorage.apiimpl.network.node.CrafterManagerNetworkNodeimport com.refinedmods.refinedstorage.tile.CrafterManagerTileimport com.refinedmods.refinedstorage.block.CrafterManagerBlockimport com.refinedmods.refinedstorage.apiimpl.network.node.FluidInterfaceNetworkNodeimport com.refinedmods.refinedstorage.tile.FluidInterfaceTileimport com.refinedmods.refinedstorage.inventory.fluid.ProxyFluidHandlerimport com.refinedmods.refinedstorage.apiimpl.storage.externalstorage.FluidExternalStorageimport com.refinedmods.refinedstorage.apiimpl.network.node.StorageMonitorNetworkNodeimport com.refinedmods.refinedstorage.tile.StorageMonitorTileimport com.refinedmods.refinedstorage.tile.craftingmonitor.ICraftingMonitorimport com.refinedmods.refinedstorage.apiimpl.network.node.CraftingMonitorNetworkNodeimport com.refinedmods.refinedstorage.tile.data .TileDataParameterimport com.refinedmods.refinedstorage.tile.craftingmonitor.CraftingMonitorTileimport com.refinedmods.refinedstorage.api.autocrafting.ICraftingManagerimport com.refinedmods.refinedstorage.block.CraftingMonitorBlockimport com.refinedmods.refinedstorage.api.storage.externalstorage.IExternalStorageContextimport com.refinedmods.refinedstorage.api.storage.externalstorage.IExternalStorageimport java.util.concurrent.CopyOnWriteArrayListimport com.refinedmods.refinedstorage.api.storage.externalstorage.IExternalStorageProviderimport com.refinedmods.refinedstorage.api.storage.StorageTypeimport com.refinedmods.refinedstorage.tile.ExternalStorageTileimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkReceiverNetworkNodeimport com.refinedmods.refinedstorage.api.network.security.ISecurityCardContainerimport com.refinedmods.refinedstorage.api.network.security.ISecurityCardimport com.refinedmods.refinedstorage.item.SecurityCardItemimport com.refinedmods.refinedstorage.apiimpl.network.security.SecurityCardimport com.refinedmods.refinedstorage.apiimpl.network.node.SecurityManagerNetworkNodeimport com.refinedmods.refinedstorage.item.NetworkCardItemimport com.refinedmods.refinedstorage.apiimpl.network.node.NetworkTransmitterNetworkNodeimport com.refinedmods.refinedstorage.tile.NetworkReceiverTileimport com.refinedmods.refinedstorage.apiimpl.network.node.WirelessTransmitterNetworkNodeimport com.refinedmods.refinedstorage.api.network.security.ISecurityManagerimport java.lang.IllegalStateExceptionimport com.refinedmods.refinedstorage.api.network.NetworkTypeimport com.refinedmods.refinedstorage.tile.config.IRedstoneConfigurableimport com.refinedmods.refinedstorage.apiimpl.network.grid.handler.ItemGridHandlerimport com.refinedmods.refinedstorage.apiimpl.network.grid.handler.FluidGridHandlerimport com.refinedmods.refinedstorage.apiimpl.network.item.NetworkItemManagerimport com.refinedmods.refinedstorage.api.network.INetworkNodeGraphimport com.refinedmods.refinedstorage.apiimpl.network.NetworkNodeGraphimport com.refinedmods.refinedstorage.apiimpl.autocrafting.CraftingManagerimport com.refinedmods.refinedstorage.apiimpl.storage.tracker.ItemStorageTrackerimport com.refinedmods.refinedstorage.apiimpl.storage.tracker.FluidStorageTrackerimport com.refinedmods.refinedstorage.energy.BaseEnergyStorageimport com.refinedmods.refinedstorage.apiimpl.network.node.RootNetworkNodeimport com.refinedmods.refinedstorage.block.ControllerBlock.EnergyTypeimport com.refinedmods.refinedstorage.block.ControllerBlockimport com.refinedmods.refinedstorage.api.storage.tracker.IStorageTrackerimport com.refinedmods.refinedstorage.api.network.INetworkNodeGraphListenerimport com.refinedmods.refinedstorage.tile.ControllerTileimport com.refinedmods.refinedstorage.api.network.INetworkManagerimport net.minecraft.nbt.ListTagimport java.util.LinkedListimport com.refinedmods.refinedstorage.api.network.node.INetworkNodeManagerimport com.refinedmods.refinedstorage.apiimpl.network.NetworkNodeManagerimport com.refinedmods.refinedstorage.api.network.node.INetworkNodeFactoryimport com.refinedmods.refinedstorage.api.network.node.INetworkNodeRegistryimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskSyncimport com.refinedmods.refinedstorage.api.storage.disk.StorageDiskSyncDataimport com.refinedmods.refinedstorage.apiimpl.storage.disk.StorageDiskSyncimport com.refinedmods.refinedstorage.network.disk.StorageDiskSizeRequestMessageimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskManagerimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskProviderimport com.refinedmods.refinedstorage.apiimpl.storage.disk.StorageDiskManagerimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskFactoryimport com.refinedmods.refinedstorage.api.storage.disk.IStorageDiskRegistryimport com.refinedmods.refinedstorage.network.grid.GridItemUpdateMessageimport com.refinedmods.refinedstorage.network.grid.GridItemDeltaMessageimport com.refinedmods.refinedstorage.network.grid.GridFluidUpdateMessageimport com.refinedmods.refinedstorage.network.grid.GridFluidDeltaMessageimport com.refinedmods.refinedstorage.network.grid.PortableGridItemUpdateMessageimport com.refinedmods.refinedstorage.network.grid.PortableGridItemDeltaMessageimport com.refinedmods.refinedstorage.network.grid.PortableGridFluidUpdateMessageimport com.refinedmods.refinedstorage.network.grid.PortableGridFluidDeltaMessageimport java.lang.UnsupportedOperationExceptionimport com.refinedmods.refinedstorage.api.storage.tracker.StorageTrackerEntryimport com.refinedmods.refinedstorage.apiimpl.storage.externalstorage.ItemExternalStorageCacheimport com.refinedmods.refinedstorage.apiimpl.storage.externalstorage.FluidExternalStorageCacheimport com.refinedmods.refinedstorage.tile.InterfaceTileimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.node.NodeRequirementsimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.node.NodeListenerimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.node.ProcessingNodeimport com.refinedmods.refinedstorage.api.autocrafting.task.CraftingTaskReadExceptionimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.node.CraftingNodeimport java.util.LinkedHashMapimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.IoUtilimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElementimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElementListimport com.refinedmods.refinedstorage.apiimpl.autocrafting.craftingmonitor.ItemCraftingMonitorElementimport com.refinedmods.refinedstorage.apiimpl.autocrafting.craftingmonitor.FluidCraftingMonitorElementimport com.refinedmods.refinedstorage.apiimpl.autocrafting.craftingmonitor.ErrorCraftingMonitorElementimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.preview.CraftingPreviewInfoimport com.refinedmods.refinedstorage.api.autocrafting.preview.ICraftingPreviewElementimport com.refinedmods.refinedstorage.apiimpl.autocrafting.preview.ItemCraftingPreviewElementimport com.refinedmods.refinedstorage.apiimpl.autocrafting.preview.FluidCraftingPreviewElementimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingRequestInfoimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.calculator.CraftingCalculatorExceptionimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.calculator.CalculationResultimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.preview.CraftingPreviewElementFactoryimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.CraftingTaskimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.CraftingPatternInputsimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.calculator.PossibleInputsimport java.util.Dequeimport java.util.stream.IntStreamimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.monitor.CraftingMonitorElementFactoryimport com.refinedmods.refinedstorage.apiimpl.storage.disk.ItemStorageDiskimport com.refinedmods.refinedstorage.apiimpl.storage.disk.FluidStorageDiskimport com.refinedmods.refinedstorage.apiimpl.storage.disk.factory.ItemStorageDiskFactoryimport com.refinedmods.refinedstorage.apiimpl.storage.disk.factory.FluidStorageDiskFactoryimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTaskFactoryimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.calculator.CraftingCalculatorimport com.refinedmods.refinedstorage.api.autocrafting.task.ICraftingTaskRegistryimport com.refinedmods.refinedstorage.util.RenderUtilsimport com.refinedmods.refinedstorage.api.autocrafting.preview.ICraftingPreviewElementRegistryimport java.util.stream.Streamimport com.refinedmods.refinedstorage.render.Stylesimport com.refinedmods.refinedstorage.util.PacketByteBufUtilsimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorElementRegistryimport com.refinedmods.refinedstorage.api.autocrafting.craftingmonitor.ICraftingMonitorListenerimport java.util.LinkedHashSetimport com.refinedmods.refinedstorage.apiimpl.autocrafting.CraftingPattern.DummyCraftingInventoryimport com.refinedmods.refinedstorage.apiimpl.autocrafting.task.v6.CraftingTaskFactoryimport com.refinedmods.refinedstorage.apiimpl.autocrafting.CraftingPatternimport com.refinedmods.refinedstorage.apiimpl.autocrafting.CraftingPatternFactoryExceptionimport com.refinedmods.refinedstorage.apiimpl.autocrafting.CraftingPatternFactory
class CraftingNode : Node {
    private val recipe: NonNullList<ItemStack>

    constructor(pattern: ICraftingPattern?, root: Boolean, recipe: NonNullList<ItemStack>) : super(pattern, root) {
        this.recipe = recipe
    }

    constructor(network: INetwork?, tag: CompoundTag) : super(network, tag) {
        recipe = NonNullList.create()
        val tookList: ListTag = tag.getList(NBT_RECIPE, Constants.NBT.TAG_COMPOUND)
        for (i in tookList.indices) {
            recipe.add(StackUtils.deserializeStackFromNbt(tookList.getCompound(i)))
        }
    }

    override fun update(network: INetwork?, ticks: Int, nodes: NodeList?, internalStorage: IStorageDisk<ItemStack?>, internalFluidStorage: IStorageDisk<FluidInstance?>?, listener: NodeListener) {
        for (container in network.craftingManager.getAllContainers(pattern)) {
            val interval: Int = container.getUpdateInterval()
            if (interval < 0) {
                throw IllegalStateException(container.toString() + " has an update interval of < 0")
            }
            if (interval == 0 || ticks % interval == 0) {
                for (i in 0 until container.getMaximumSuccessfulCraftingUpdates()) {
                    if (IoUtil.extractFromInternalItemStorage(requirements.getSingleItemRequirementSet(true), internalStorage, Action.SIMULATE) != null) {
                        IoUtil.extractFromInternalItemStorage(requirements.getSingleItemRequirementSet(false), internalStorage, Action.PERFORM)
                        val output: ItemStack = pattern.getOutput(recipe)
                        if (!isRoot) {
                            internalStorage.insert(output, output.getCount(), Action.PERFORM)
                        } else {
                            val remainder: ItemStack = network.insertItem(output, output.getCount(), Action.PERFORM)
                            internalStorage.insert(remainder, remainder.getCount(), Action.PERFORM)
                        }

                        // Byproducts need to always be inserted in the internal storage for later reuse further in the task.
                        // Regular outputs can be inserted into the network *IF* it's a root since it's *NOT* expected to be used later on.
                        for (byp in pattern.getByproducts(recipe)) {
                            internalStorage.insert(byp, byp.getCount(), Action.PERFORM)
                        }
                        next()
                        listener.onSingleDone(this)
                        if (getQuantity() <= 0) {
                            listener.onAllDone(this)
                            return
                        }
                    } else {
                        break
                    }
                }
            }
        }
    }

    override fun writeToNbt(): CompoundTag? {
        val tag: CompoundTag? = super.writeToNbt()
        val tookList = ListTag()
        for (took in recipe) {
            tookList.add(StackUtils.serializeStackToNbt(took))
        }
        tag.put(NBT_RECIPE, tookList)
        return tag
    }

    companion object {
        private const val NBT_RECIPE = "Recipe"
    }
}